<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Parking Garage Control System: Parking Garage Control System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Parking Garage Control System
   </div>
   <div id="projectbrief">ESP32 Parking Garage – ESP-IDF/FreeRTOS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Parking Garage Control System </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> Event-driven parking garage control system for ESP32 using ESP-IDF and FreeRTOS.</p>
<p><img src="https://github.com/0xfischer/parking_garage_control_system/actions/workflows/build.yml/badge.svg" alt="Build" style="pointer-events: none;" class="inline"/> <img src="https://github.com/0xfischer/parking_garage_control_system/actions/workflows/host-tests.yml/badge.svg" alt="Host Tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/0xfischer/parking_garage_control_system/actions/workflows/unity-hw-tests.yml/badge.svg" alt="Unity HW Tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/0xfischer/parking_garage_control_system/actions/workflows/wokwi-tests.yml/badge.svg" alt="Wokwi Tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/0xfischer/parking_garage_control_system/actions/workflows/format.yml/badge.svg" alt="Format" style="pointer-events: none;" class="inline"/> <img src="https://github.com/0xfischer/parking_garage_control_system/actions/workflows/docs.yml/badge.svg" alt="Docs" style="pointer-events: none;" class="inline"/> <img src="https://github.com/0xfischer/parking_garage_control_system/actions/workflows/coverage.yml/badge.svg" alt="Coverage" style="pointer-events: none;" class="inline"/> <a href="https://github.com/0xfischer/parking_garage_control_system/releases"><img src="https://img.shields.io/github/v/release/0xfischer/parking_garage_control_system?label=release" alt="Releases" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Features</h1>
<ul>
<li><b>Event-Driven Architecture</b>: GPIO interrupts trigger events processed by state machines</li>
<li><b>Hardware Abstraction Layer</b>: Testable design with mock implementations</li>
<li><b>State Machines</b>: Entry and exit gate controllers with well-defined states</li>
<li><b><a class="el" href="structTicket.html" title="Parking ticket structure.">Ticket</a> System</b>: Complete ticket lifecycle management (issue, pay, validate)</li>
<li><b>ESP Console</b>: Interactive command-line interface for monitoring and control</li>
<li><b>Configurable</b>: GPIO pins and capacity configurable via Kconfig</li>
<li><b>Thread-Safe</b>: FreeRTOS mutex and queue protection</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Demo</h1>
<p><img src="demo.gif" alt="Demo" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md3"></a>
Quick Start</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
Prerequisites</h2>
<ul>
<li>ESP-IDF v5.5 or later</li>
<li>ESP32 development board</li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
Build and Flash</h2>
<div class="fragment"><div class="line"># Set up ESP-IDF environment</div>
<div class="line">. $IDF_PATH/export.sh</div>
<div class="line"> </div>
<div class="line"># Build</div>
<div class="line">idf.py build</div>
<div class="line"> </div>
<div class="line"># Flash and monitor</div>
<div class="line">idf.py -p /dev/ttyUSB0 flash monitor</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Configuration</h2>
<p>Use <code>idf.py menuconfig</code> to configure:</p><ul>
<li><b>GPIO pins</b>: "Parking Garage Control System Configuration" → "GPIO Configuration"</li>
<li><b>Capacity</b>: Choose Test Mode (5 spaces) or Production Mode (2000 spaces)</li>
<li><b>Timings</b>: Barrier timeout, button debounce</li>
</ul>
<h1><a class="anchor" id="autotoc_md7"></a>
Hardware Configuration</h1>
<p>Default GPIO assignment:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">GPIO   </th><th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Entry Button   </td><td class="markdownTableBodyNone">25   </td><td class="markdownTableBodyNone">Input   </td><td class="markdownTableBodyNone">Active low, internal pull-up    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Entry Light Barrier   </td><td class="markdownTableBodyNone">23   </td><td class="markdownTableBodyNone">Input   </td><td class="markdownTableBodyNone">LOW = car detected    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Entry Barrier Servo   </td><td class="markdownTableBodyNone">22   </td><td class="markdownTableBodyNone">PWM   </td><td class="markdownTableBodyNone">LEDC Channel 0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Exit Light Barrier   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Input   </td><td class="markdownTableBodyNone">LOW = car detected    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Exit Barrier Servo   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">PWM   </td><td class="markdownTableBodyNone">LEDC Channel 1   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md8"></a>
Servo Motors</h2>
<p>The barrier gates use servo motors with PWM signals:</p><ul>
<li><b>Frequency</b>: 50Hz (standard servo)</li>
<li><b>Closed (90°)</b>: 1.5ms pulse - Barrier vertical</li>
<li><b>Open (0°)</b>: 1ms pulse - Barrier horizontal</li>
<li><b>PWM Generation</b>: ESP32 LEDC with 14-bit resolution</li>
</ul>
<h1><a class="anchor" id="autotoc_md9"></a>
Architecture</h1>
<h2><a class="anchor" id="autotoc_md10"></a>
System Overview</h2>
<div class="fragment"><div class="line">graph TB</div>
<div class="line">    subgraph ParkingGarageSystem[&quot;&lt;b style=&#39;font-size:16px&#39;&gt;PARKING GARAGE SYSTEM&lt;/b&gt;&lt;br/&gt;(Main Orchestrator)&quot;]</div>
<div class="line">        EventBus[&quot;EventBus&lt;br/&gt;(FreeRTOS Queue)&quot;]</div>
<div class="line">        TicketService[&quot;TicketService&lt;br/&gt;(Capacity &amp; Tickets)&quot;]</div>
<div class="line">        Console[&quot;Console Commands&lt;br/&gt;(User Interface)&quot;]</div>
<div class="line">    end</div>
<div class="line">    subgraph EntryController[&quot;EntryGateController&lt;br/&gt;(State Machine)&quot;]</div>
<div class="line">        EntryGate[&quot;Gate&lt;br/&gt;(Hardware Abstraction)&quot;]</div>
<div class="line">        EntryButton[&quot;Button&lt;br/&gt;(GPIO Input)&quot;]</div>
<div class="line">        EntryLightBarrier[&quot;Light Barrier&lt;br/&gt;(GPIO Input)&quot;]</div>
<div class="line">        EntryMotor[&quot;Servo Motor&lt;br/&gt;(PWM Output)&quot;]</div>
<div class="line"> </div>
<div class="line">        EntryGate --&gt; EntryButton</div>
<div class="line">        EntryGate --&gt; EntryLightBarrier</div>
<div class="line">        EntryGate --&gt; EntryMotor</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    subgraph ExitController[&quot;ExitGateController&lt;br/&gt;(State Machine)&quot;]</div>
<div class="line">        ExitGate[&quot;Gate&lt;br/&gt;(Hardware Abstraction)&quot;]</div>
<div class="line">        ExitLightBarrier[&quot;Light Barrier&lt;br/&gt;(GPIO Input)&quot;]</div>
<div class="line">        ExitMotor[&quot;Servo Motor&lt;br/&gt;(PWM Output)&quot;]</div>
<div class="line"> </div>
<div class="line">        ExitGate --&gt; ExitLightBarrier</div>
<div class="line">        ExitGate --&gt; ExitMotor</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    %%Console[&quot;Console Commands&lt;br/&gt;(User Interface)&quot;]</div>
<div class="line"> </div>
<div class="line">    ParkingGarageSystem --&gt; EntryController</div>
<div class="line">    ParkingGarageSystem --&gt; ExitController</div>
<div class="line">    %%ParkingGarageSystem --&gt; Console</div>
<div class="line"> </div>
<div class="line">    EventBus -.publishes/subscribes.-&gt; EntryController</div>
<div class="line">    EventBus -.publishes/subscribes.-&gt; ExitController</div>
<div class="line"> </div>
<div class="line">    TicketService -.uses.-&gt; EntryController</div>
<div class="line">    TicketService -.uses.-&gt; ExitController</div>
<div class="line"> </div>
<div class="line">    %%Console -.controls.-&gt; TicketService</div>
<div class="line">    %%Console -.controls.-&gt; EntryController</div>
<div class="line">    %%Console -.controls.-&gt; ExitController</div>
<div class="line"> </div>
<div class="line">    classDef system fill:#e1f5ff,stroke:#01579b,stroke-width:3px</div>
<div class="line">    classDef controller fill:#fff9c4,stroke:#f57f17,stroke-width:2px</div>
<div class="line">    classDef hardware fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px</div>
<div class="line">    classDef service fill:#f8bbd0,stroke:#c2185b,stroke-width:2px</div>
<div class="line"> </div>
<div class="line">    class ParkingGarageSystem,Console system</div>
<div class="line">    class EntryController,ExitController controller</div>
<div class="line">    class EntryGate,ExitGate,EntryButton,EntryLightBarrier,EntryMotor,ExitLightBarrier,ExitMotor hardware</div>
<div class="line">    class EventBus,TicketService service</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md11"></a>
Ownership &amp; Construction Flow</h2>
<div class="fragment"><div class="line">graph LR</div>
<div class="line">    subgraph Production[&quot;Production Mode&quot;]</div>
<div class="line">        PS1[ParkingGarageSystem] --&gt;|creates| EB1[EventBus]</div>
<div class="line">        PS1 --&gt;|creates| TS1[TicketService]</div>
<div class="line">        PS1 --&gt;|creates with&lt;br/&gt;EntryGateConfig&lt;br/&gt;+ refs| EC1[EntryGateController]</div>
<div class="line">        PS1 --&gt;|creates with&lt;br/&gt;ExitGateConfig&lt;br/&gt;+ refs| XC1[ExitGateController]</div>
<div class="line"> </div>
<div class="line">        EB1 -.referenced by.-&gt; EC1</div>
<div class="line">        EB1 -.referenced by.-&gt; XC1</div>
<div class="line">        TS1 -.referenced by.-&gt; EC1</div>
<div class="line">        TS1 -.referenced by.-&gt; XC1</div>
<div class="line"> </div>
<div class="line">        EC1 --&gt;|owns| G1[Gate]</div>
<div class="line">        XC1 --&gt;|owns| G2[Gate]</div>
<div class="line"> </div>
<div class="line">        G1 --&gt;|creates| HW1[Button + LightBarrier&lt;br/&gt;+ Motor]</div>
<div class="line">        G2 --&gt;|creates| HW2[LightBarrier&lt;br/&gt;+ Motor]</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">%%    subgraph Testing[&quot;Test Mode&quot;]</div>
<div class="line">%%        Test[Test Code] --&gt;|injects| EC2[EntryGateController]</div>
<div class="line">%%        Test --&gt;|injects| MockGate</div>
<div class="line">%%        Test --&gt;|injects| MockButton</div>
<div class="line">%%</div>
<div class="line">%%        EC2 -.references.-&gt; MockGate</div>
<div class="line">%%        EC2 -.references.-&gt; MockButton</div>
<div class="line">%%    end</div>
<div class="line"> </div>
<div class="line">    classDef prod fill:#e1f5ff,stroke:#01579b,stroke-width:2px</div>
<div class="line">    classDef test fill:#fff9c4,stroke:#f57f17,stroke-width:2px</div>
<div class="line"> </div>
<div class="line">    class PS1,EC1,XC1,G1,G2,HW1,HW2 prod</div>
<div class="line">    class Test,EC2,MockGate,MockButton test</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
Key Design Principles</h2>
<ul>
<li><b>Config-Based Construction</b>: Controllers accept config structs with all GPIO pins and settings</li>
<li><b>Ownership Hierarchy</b>: Controllers own their <a class="el" href="classGate.html" title="Concrete gate implementation using GPIO.">Gate</a> hardware (Button, LightBarrier, Motor)</li>
<li><b>Clean Separation</b>: <a class="el" href="classParkingGarageSystem.html" title="Main parking garage system orchestrator.">ParkingGarageSystem</a> manages only controllers and services, not low-level GPIO</li>
<li><b>Dual Constructors</b>: Production mode creates hardware, test mode accepts mocks</li>
<li><b>Interrupt Setup</b>: Controllers configure their own GPIO interrupts via <code>setupGpioInterrupts()</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
State Machines</h2>
<h3><a class="anchor" id="autotoc_md14"></a>
Entry Gate</h3>
<div class="fragment"><div class="line">stateDiagram-v2</div>
<div class="line">    [*] --&gt; Idle</div>
<div class="line"> </div>
<div class="line">    Idle --&gt; CheckingCapacity : Button Pressed</div>
<div class="line">    CheckingCapacity --&gt; IssuingTicket : Capacity Available</div>
<div class="line">    CheckingCapacity --&gt; Idle : Parking Full</div>
<div class="line">    IssuingTicket --&gt; OpeningBarrier : Ticket Issued</div>
<div class="line">    OpeningBarrier --&gt; WaitingForCar : Barrier Opened</div>
<div class="line">    WaitingForCar --&gt; CarPassing : Light Barrier Blocked</div>
<div class="line">    CarPassing --&gt; WaitingBeforeClose : Light Barrier Cleared</div>
<div class="line">    WaitingBeforeClose --&gt; ClosingBarrier : delay</div>
<div class="line">    ClosingBarrier --&gt; Idle : Barrier Closed</div>
</div><!-- fragment --><p> <b>Events</b>:</p><ul>
<li><code>EntryButtonPressed</code> → Trigger capacity check</li>
<li><code>CapacityFull</code> → Reject entry</li>
<li><code>TicketIssued</code> → Allow entry</li>
<li><code>EntryLightBarrierBlocked</code> → Car detected</li>
<li><code>EntryLightBarrierCleared</code> → Car passed</li>
<li><code>BarrierTimeout</code> → Barrier movement complete</li>
</ul>
<h3><a class="anchor" id="autotoc_md15"></a>
Exit Gate</h3>
<div class="fragment"><div class="line">stateDiagram-v2</div>
<div class="line">    [*] --&gt; Idle</div>
<div class="line"> </div>
<div class="line">    Idle --&gt; ValidatingTicket : ticket validate command</div>
<div class="line">    ValidatingTicket --&gt; OpeningBarrier : Ticket Paid</div>
<div class="line">    ValidatingTicket --&gt; Idle : Ticket Unpaid/Invalid</div>
<div class="line">    OpeningBarrier --&gt; WaitingForCarToPass : Barrier Opened</div>
<div class="line">    WaitingForCarToPass --&gt; CarPassing : Light Barrier Blocked</div>
<div class="line">    CarPassing --&gt; WaitingBeforeClose : Light Barrier Cleared</div>
<div class="line">    WaitingBeforeClose --&gt; ClosingBarrier : delay</div>
<div class="line">    ClosingBarrier --&gt; Idle : Barrier Closed</div>
</div><!-- fragment --><p> <b>States</b>:</p><ul>
<li><b>Idle</b>: Waiting for manual ticket validation command</li>
<li><b>ValidatingTicket</b>: Checking ticket payment status</li>
<li><b>OpeningBarrier</b>: Motor opening barrier (HIGH)</li>
<li><b>WaitingForCarToPass</b>: Barrier open, waiting for vehicle</li>
<li><b>CarPassing</b>: Vehicle passing through light barrier</li>
<li><b>WaitingBeforeClose</b>: 2-second safety delay after car exited</li>
<li><b>ClosingBarrier</b>: Motor closing barrier (LOW)</li>
</ul>
<h1><a class="anchor" id="autotoc_md16"></a>
Console Commands</h1>
<p>Available commands in the ESP console: </p><div class="fragment"><div class="line">=== Parking Garage Control System ===</div>
<div class="line"> </div>
<div class="line">Available Commands:</div>
<div class="line">  status                    - Show system status</div>
<div class="line">  ticket list               - List all tickets</div>
<div class="line">  ticket pay &lt;id&gt;           - Pay ticket</div>
<div class="line">  ticket validate &lt;id&gt;      - Validate ticket for exit</div>
<div class="line">  publish &lt;event&gt;           - Publish event (use &#39;list&#39;)</div>
<div class="line">  gpio                      - GPIO read/write</div>
<div class="line">  test &lt;entry|exit|full&gt;    - Hardware test guides</div>
<div class="line">  help                      - Show help</div>
<div class="line">  restart                   - Restart system</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
GPIO Control</h2>
<div class="fragment"><div class="line"># Read states</div>
<div class="line">gpio read entry button      # Read entry button (GPIO 25)</div>
<div class="line">gpio read entry barrier     # Read entry light barrier (GPIO 23)</div>
<div class="line">gpio read exit barrier      # Read exit light barrier (GPIO 4)</div>
<div class="line"> </div>
<div class="line"># Control motors</div>
<div class="line">gpio write entry motor open   # Open entry barrier</div>
<div class="line">gpio write entry motor close  # Close entry barrier</div>
<div class="line">gpio write exit motor open    # Open exit barrier</div>
<div class="line">gpio write exit motor close   # Close exit barrier</div>
<div class="line"> </div>
<div class="line"># Simulate inputs (via events)</div>
<div class="line">gpio write entry button pressed      # Simulate button press</div>
<div class="line">gpio write entry barrier blocked     # Simulate car at entry</div>
<div class="line">gpio write entry barrier cleared     # Simulate car passed entry</div>
<div class="line">gpio write exit barrier blocked      # Simulate car at exit</div>
<div class="line">gpio write exit barrier cleared      # Simulate car passed exit</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
Example: Complete Entry/Exit Flow</h2>
<div class="fragment"><div class="line">publish EntryButtonPressed           # Ticket #1 created, barrier opens</div>
<div class="line">publish EntryLightBarrierBlocked     # Car detected</div>
<div class="line">publish EntryLightBarrierCleared     # Car passed, barrier closes</div>
<div class="line">ticket pay 1                         # Pay ticket</div>
<div class="line">ticket validate 1                    # Validate ticket, exit barrier opens</div>
<div class="line">publish ExitLightBarrierBlocked      # Car exiting</div>
<div class="line">publish ExitLightBarrierCleared      # Car exited, barrier closes</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md19"></a>
Testing</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Location   </th><th class="markdownTableHeadNone">Runs On   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Host Tests</b>   </td><td class="markdownTableBodyNone"><code>test/unit-tests/</code>   </td><td class="markdownTableBodyNone">PC (g++)   </td><td class="markdownTableBodyNone">Fast logic tests with mocks    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Unity HW Tests</b>   </td><td class="markdownTableBodyNone"><code>test/unity-hw-tests/</code>   </td><td class="markdownTableBodyNone">ESP32/Wokwi   </td><td class="markdownTableBodyNone">Hardware integration tests    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Wokwi Simulation</b>   </td><td class="markdownTableBodyNone"><code>test/wokwi-tests/</code>   </td><td class="markdownTableBodyNone">Wokwi CI   </td><td class="markdownTableBodyNone">Full system simulation   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md20"></a>
Run Tests</h2>
<div class="fragment"><div class="line"># Host tests (fast, no hardware needed)</div>
<div class="line">make test-host</div>
<div class="line"> </div>
<div class="line"># Host tests with coverage</div>
<div class="line">make coverage-run</div>
<div class="line">open build-host/coverage.html</div>
<div class="line"> </div>
<div class="line"># Unity hardware tests (requires ESP32 or Wokwi)</div>
<div class="line">make test-unity-wokwi</div>
<div class="line"> </div>
<div class="line"># Wokwi simulation tests</div>
<div class="line">idf.py -DSDKCONFIG_DEFAULTS=&quot;sdkconfig.defaults;sdkconfig.ci&quot; build </div>
<div class="line">or</div>
<div class="line">make build-ci</div>
<div class="line"> </div>
<div class="line">export WOKWI_CLI_TOKEN=wok_xxx</div>
<div class="line">wokwi-cli --scenario test/wokwi-tests/console_full.yaml</div>
</div><!-- fragment --><p>For detailed test documentation, see test/README.md.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
CI/CD Workflows</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Workflow   </th><th class="markdownTableHeadNone">Trigger   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Build</b>   </td><td class="markdownTableBodyNone">Push/PR   </td><td class="markdownTableBodyNone">Build firmware with ESP-IDF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Host Tests</b>   </td><td class="markdownTableBodyNone">Push/PR   </td><td class="markdownTableBodyNone">Run unit tests with coverage    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Unity HW Tests</b>   </td><td class="markdownTableBodyNone">Push/PR   </td><td class="markdownTableBodyNone">Run hardware tests on Wokwi    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Wokwi Tests</b>   </td><td class="markdownTableBodyNone">Manual   </td><td class="markdownTableBodyNone">Full simulation tests    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Format</b>   </td><td class="markdownTableBodyNone">Push/PR   </td><td class="markdownTableBodyNone">Check code formatting    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Tidy</b>   </td><td class="markdownTableBodyNone">Manual   </td><td class="markdownTableBodyNone">Run clang-tidy analysis    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Docs</b>   </td><td class="markdownTableBodyNone">Push to main   </td><td class="markdownTableBodyNone">Generate and deploy Doxygen docs    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Release</b>   </td><td class="markdownTableBodyNone">Tag <code>vX.Y.Z</code>   </td><td class="markdownTableBodyNone">Create release with artifacts   </td></tr>
</table>
<blockquote class="doxtable">
<p>&zwj;Tip: For local GitHub Actions testing, see <code>ACT.md</code>. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md22"></a>
Documentation</h1>
<ul>
<li><b>Main Site / API (Doxygen)</b>: <a href="https://0xfischer.github.io/parking_garage_control_system/">https://0xfischer.github.io/parking_garage_control_system/</a></li>
<li><b>Coverage Report</b>: <a href="https://0xfischer.github.io/parking_garage_control_system/coverage/">https://0xfischer.github.io/parking_garage_control_system/coverage/</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md23"></a>
Devcontainer</h1>
<p>A devcontainer image with all tools is available:</p>
<div class="fragment"><div class="line"># Push to GHCR</div>
<div class="line">GITHUB_TOKEN=ghp_xxx tools/release_devcontainer_to_github.sh</div>
<div class="line"> </div>
<div class="line"># With tag</div>
<div class="line">GITHUB_TOKEN=ghp_xxx tools/release_devcontainer_to_github.sh --tag v5.5</div>
<div class="line"> </div>
<div class="line">tools/release_devcontainer_to_github.sh --tag v5.2.2 --image ghcr.io/0xfischer/parking_garage_control_system-dev:latest</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md24"></a>
Project Structure</h1>
<div class="fragment"><div class="line">parking_garage_control_system/</div>
<div class="line">├── components/parking_system/</div>
<div class="line">│   ├── include/</div>
<div class="line">│   │   ├── events/       # IEventBus, FreeRtosEventBus</div>
<div class="line">│   │   ├── gates/        # Gate controllers &amp; abstractions</div>
<div class="line">│   │   ├── hal/          # Hardware Abstraction Layer</div>
<div class="line">│   │   ├── tickets/      # Ticket service</div>
<div class="line">│   │   └── parking/      # Main orchestrator</div>
<div class="line">│   └── src/              # Implementation files</div>
<div class="line">├── main/</div>
<div class="line">│   ├── main.cpp          # Application entry point</div>
<div class="line">│   └── console_commands.cpp</div>
<div class="line">├── test/</div>
<div class="line">│   ├── unit-tests/       # Host unit tests</div>
<div class="line">│   ├── unity-hw-tests/   # ESP32 hardware tests</div>
<div class="line">│   ├── wokwi-tests/      # Wokwi simulation scenarios</div>
<div class="line">│   └── mocks/            # Mock implementations</div>
<div class="line">├── examples/</div>
<div class="line">│   ├── hal_state_machine/</div>
<div class="line">│   └── event_driven_state_machine/</div>
<div class="line">└── .github/workflows/    # CI/CD pipelines</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md25"></a>
Lint &amp; Format</h1>
<ul>
<li><b>clang-format</b>: Code formatting (configured in <code>.clang-format</code>)</li>
<li><b>clang-tidy</b>: Static analysis (configured in <code>.clang-tidy</code>)</li>
</ul>
<div class="fragment"><div class="line"># Format code</div>
<div class="line">make format</div>
<div class="line">make format-check</div>
<div class="line">make format-changed</div>
<div class="line"> </div>
<div class="line"># Run clang-tidy (requires compile_commands.json)</div>
<div class="line">make lint-tidy</div>
<div class="line">make lint-tidy-changed</div>
</div><!-- fragment --><p>Git hooks:</p><ul>
<li><code>pre-commit</code>: Checks formatting on staged files</li>
<li><code>pre-push</code>: Optional clang-tidy (<code>ENABLE_TIDY=1 git push</code>)</li>
</ul>
<h1><a class="anchor" id="autotoc_md26"></a>
License</h1>
<p>MIT License</p>
<h1><a class="anchor" id="autotoc_md27"></a>
Author</h1>
<p>Eugen Fischer</p>
<p>Created with Claude Code </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- Custom footer to enable Mermaid on Doxygen HTML pages -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<!-- mermaid-init.js is copied into the HTML output root by HTML_EXTRA_FILES; use  to resolve from nested pages -->
<script src="mermaid-init.js"></script>
<!-- Quick access link to Coverage report (visible on all pages) -->
<a href="coverage/index.html" style="
	position: fixed;
	right: 16px;
	bottom: 16px;
	background: #0d6efd;
	color: #fff;
	text-decoration: none;
	padding: 8px 12px;
	border-radius: 6px;
	font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
	box-shadow: 0 2px 8px rgba(0,0,0,0.2);
">Coverage</a>