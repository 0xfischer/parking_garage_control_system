name: Parking Full Rejection
version: 1

steps:
  # Wait for system boot
  - wait: 3000

  - serial-wait-for: "Console ready"
    timeout: 10000

  # Fill parking with 5 cars (default capacity)
  # Car 1
  - button-press: btn-entry
    duration: 100
  - serial-wait-for: "Ticket issued"
    timeout: 5000
  - wait: 500
  - set-control: { part: light-entry, control: value, value: 1 }
  - wait: 500
  - set-control: { part: light-entry, control: value, value: 0 }
  - wait: 5000

  # Car 2
  - button-press: btn-entry
    duration: 100
  - serial-wait-for: "Ticket issued"
    timeout: 5000
  - wait: 500
  - set-control: { part: light-entry, control: value, value: 1 }
  - wait: 500
  - set-control: { part: light-entry, control: value, value: 0 }
  - wait: 5000

  # Car 3
  - button-press: btn-entry
    duration: 100
  - serial-wait-for: "Ticket issued"
    timeout: 5000
  - wait: 500
  - set-control: { part: light-entry, control: value, value: 1 }
  - wait: 500
  - set-control: { part: light-entry, control: value, value: 0 }
  - wait: 5000

  # Car 4
  - button-press: btn-entry
    duration: 100
  - serial-wait-for: "Ticket issued"
    timeout: 5000
  - wait: 500
  - set-control: { part: light-entry, control: value, value: 1 }
  - wait: 500
  - set-control: { part: light-entry, control: value, value: 0 }
  - wait: 5000

  # Car 5 (last spot)
  - button-press: btn-entry
    duration: 100
  - serial-wait-for: "Ticket issued"
    timeout: 5000
  - wait: 500
  - set-control: { part: light-entry, control: value, value: 1 }
  - wait: 500
  - set-control: { part: light-entry, control: value, value: 0 }
  - wait: 5000

  # Car 6 - should be rejected
  - button-press: btn-entry
    duration: 100

  - serial-wait-for: "Parking full"
    timeout: 5000

  # Verify we return to Idle without issuing ticket
  - serial-wait-for: "Idle"
    timeout: 3000
