name: Parking Full Rejection
version: 1

steps:
  - wait-serial: "Console ready"

  # Fill parking with 5 cars (default capacity)
  # Car 1
  - set-control:
      part-id: btn-entry
      control: pressed
      value: 0
  - delay: 100ms
  - set-control:
      part-id: btn-entry
      control: pressed
      value: 1
  - wait-serial: "Ticket issued"
  - delay: 500ms
  - set-control:
      part-id: light-entry
      control: value
      value: 1
  - delay: 500ms
  - set-control:
      part-id: light-entry
      control: value
      value: 0
  - delay: 5000ms

  # Car 2
  - set-control:
      part-id: btn-entry
      control: pressed
      value: 0
  - delay: 100ms
  - set-control:
      part-id: btn-entry
      control: pressed
      value: 1
  - wait-serial: "Ticket issued"
  - delay: 500ms
  - set-control:
      part-id: light-entry
      control: value
      value: 1
  - delay: 500ms
  - set-control:
      part-id: light-entry
      control: value
      value: 0
  - delay: 5000ms

  # Car 3
  - set-control:
      part-id: btn-entry
      control: pressed
      value: 0
  - delay: 100ms
  - set-control:
      part-id: btn-entry
      control: pressed
      value: 1
  - wait-serial: "Ticket issued"
  - delay: 500ms
  - set-control:
      part-id: light-entry
      control: value
      value: 1
  - delay: 500ms
  - set-control:
      part-id: light-entry
      control: value
      value: 0
  - delay: 5000ms

  # Car 4
  - set-control:
      part-id: btn-entry
      control: pressed
      value: 0
  - delay: 100ms
  - set-control:
      part-id: btn-entry
      control: pressed
      value: 1
  - wait-serial: "Ticket issued"
  - delay: 500ms
  - set-control:
      part-id: light-entry
      control: value
      value: 1
  - delay: 500ms
  - set-control:
      part-id: light-entry
      control: value
      value: 0
  - delay: 5000ms

  # Car 5 (last spot)
  - set-control:
      part-id: btn-entry
      control: pressed
      value: 0
  - delay: 100ms
  - set-control:
      part-id: btn-entry
      control: pressed
      value: 1
  - wait-serial: "Ticket issued"
  - delay: 500ms
  - set-control:
      part-id: light-entry
      control: value
      value: 1
  - delay: 500ms
  - set-control:
      part-id: light-entry
      control: value
      value: 0
  - delay: 5000ms

  # Car 6 - should be rejected
  - set-control:
      part-id: btn-entry
      control: pressed
      value: 0
  - delay: 100ms
  - set-control:
      part-id: btn-entry
      control: pressed
      value: 1

  - wait-serial: "Parking full"

  # Verify we return to Idle without issuing ticket
  - wait-serial: "Idle"
